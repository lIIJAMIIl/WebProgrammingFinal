<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quotes Application</title>
    <script src="https://unpkg.com/vue@3.0.11/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body style="background-color: #232d3f;">
<div id="app">
    <div style="background-color: #005b41; border-color: #008170 !important;" class="container justify-content-center text-center border border-4 rounded-3 pt-3">
        <div style="border-color: #232d3f !important;" class="border justify-content-center border-4 rounded-3 d-inline-block w-25 text-white">
            <h1>The Quote Creation Application</h1>
        </div>
        <div class="text-end pb-3">
            <a href="/logout"><button class="btn btn-dark">Logout</button></a>
        </div>
    </div>
    <hr>
    <div style="background-color:#232d3f; border-color: #008170 !important;" class="container justify-content-center text-center p-3">
        <form action="/quotes" method="POST">
            <input type="text" id="search" name="search" placeholder="Search quotes...">
            <button type="submit" class="btn btn-dark">Search</button>
        </form>
    </div>

    <div style="background-color:#232d3f; border-color: #008170 !important;" class="container justify-content-center text-center border border-4 rounded-3 p-3">
        <table class="container-fluid text-white">
            <thead>
            <tr>
                <h3 class="text-white">User Quotes</h3>
            </tr>
            <hr style="border-color: #008170;"/>
            <tr>
                <th>
                    Quote
                </th>
                <th>
                    Author
                </th>
                <th>
                    Edit/Delete/View Comments
                </th>
            </tr>
            </thead>
            <tbody>
            <div v-for="quote in quotes" :key="quote._id">
                <tr>
                    <td class="text-white">
                        ${ quote.text }
                    </td>
                    <td class="text-white">
                        <em>--</em>
                        <em>${ quote.author }</em>
                    </td>
                    <td class="text-white">
                        [
                        <a :href="'/edit/' + quote._id"><i style="color:#008170" class="material-icons">mode_edit</i></a>
                        <a :href="'/delete/' + quote._id"><i style="color:#008170" class="material-icons">delete</i></a>
                        ]
                    </td>
                </tr>
            </div>
            <div v-for="quote in quotes" :key="quote._id">
                <tr>
                    <td class="text-white">
                        ${ quote.text }
                    </td>
                    <td class="text-white">
                        <em>--</em>
                        <em>${ quote.author }</em>
                    </td>
                    <td class="text-white">
                        <a :href="'/edit/' + quote._id"><i style="color:#008170" class="material-icons">mode_edit</i></a>
                        <a :href="'/delete/' + quote._id"><i style="color:#008170" class="material-icons">delete</i></a>
                        <a v-if="quote.allow_comments" :href="'/comment/' + quote._id"><i style="color:#008170" class="material-icons">comment</i></a>
                    </td>
                </tr>
            </div>
            </tbody>
        </table>
        <table class="container-fluid text-white">
            <thead>
            <tr>
                <h3 class="text-white">Public Quotes</h3>
            </tr>
            <hr style="border-color: #008170;"/>
            <tr>
                <th>
                    Public Quote
                </th>
                <th>
                    Author
                </th>
                <th>
                    Edit/Delete/View Comments
                </th>
            </tr>
            </thead>
            <tbody>
            <div v-for="quote in publicData" :key="quote._id">
                <tr>
                    <td class="text-white">
                        ${ quote.text }
                    </td>
                    <td class="text-white">
                        <em>--</em>
                        <em>${ quote.author }</em>
                    </td>
                    <td class="text-white">
                        [
                        <div v-if="quote.owner == user">
                            <a href="'/delete/' + quote._id"><i style="color:#008170" class="material-icons">delete</i></a>
                            <a href="'/edit/' + quote._id"><i style="color:#008170" class="material-icons">mode_edit</i></a>
                        </div>
                        <div v-if="quote.allow_comment == true">
                            <a href="'/comment/' + quote._id"><i style="color:#008170" class="material-icons">comment</i></a>
                        </div>
                        ]
                    </td>
                </tr>
            </div>
            </tbody>
        </table>
        <hr />
        <a href="/create"><button class="btn btn-dark">Create a quote</button></a>
    </div>
    <br>
    <div class="container justify-content-center">
        <h2 class="text-white text-center">Favorite Quotes</h2>
        <br>
        <table class="container-fluid text-white">
            <thead class="text-center">
            <tr>
                <th class="w-50">
                    Favorite Quote
                </th>
                <th class="w-50">
                    Quote Author
                </th>
            </tr>
            </thead>
            <tbody class="text-center">
            <div v-for="quote in quotes" :key="quote._id">
                <div v-if="quote.owner == user">
                    <tr>
                        <td style="padding:10px">
                            ${ quote.text }
                        </td>
                        <td>
                            <em>--</em>
                            <em>${ quote.author }</em>
                        </td>
                    </tr>
                </div>
            </div>
            </tbody>
        </table>
    </div>
    <div class="container justify-content-center text-center text-white">
        <hr />
        Current User: ${user}
        <hr />
        You have been here ${number_of_visits} times!
        <hr />
        Session Id is${session_id}
    </div>
</div>

<script>
    const app = Vue.createApp({
    delimiters: ['${' , '}'],
    data() {
        return {
            user: '',
            numVisits: 0,
            quotes: [],
            quote: {},
            public_data: [], 
            number_of_visits: 0, 
            session_id: '' 
        }
    },
    mounted() {
        console.log("Mounted is called")
        axios.get('/quotesVue')
        .then( response => {
            console.log("API response: ", response);
            this.quotes = response.data.quotes;
            this.publicData = response.data.public_quotes;
            this.number_of_visits = response.data.number_of_visits;
            this.session_id = response.data.session_id;
            this.user = response.data.user;
            if (this.quotes.length > 0) {
                this.quote = this.quotes[0];
            }
        })
        .catch(error => {
            console.error('Error fetching quotes: ', error);
        });
    }
})
</script>

<script>const mountedApp = app.mount('#app')</script>

</body>
</html>